<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Singer Page</title>
  <style>
    /* ì „ì²´ í™”ë©´ì„ ì—¬ë°± ì—†ì´ ì±„ìš°ëŠ” ê¸°ë³¸ ì„¤ì • */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }

    body {
      background: #000;
    }

    /* ì§€ë„ ì»¨í…Œì´ë„ˆ: ê¸°ì¤€ì  ì—­í•  */
    #map-container {
      position: relative;
      width: 100vw;
      height: 100vh; /* í™”ë©´ ê½‰ ì±„ìš°ë„ë¡ ë†’ì´ë¥¼ ê³ ì • */
      overflow: hidden;
    }

    /* ì§€ë„ ë ˆì´ì–´: ë‘ ì¥ì„ ê²¹ì³ì„œ ë¶€ë“œëŸ½ê²Œ ì „í™˜ */
    .map-layer {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.6s ease;
      display: block;
    }

    #map-day {
      opacity: 1;
    }

    #map-night {
      opacity: 0;
    }

    /* ë°¤ ëª¨ë“œì¼ ë•Œ ë ˆì´ì–´ íˆ¬ëª…ë„ ì „í™˜ */
    #map-container.is-night #map-day {
      opacity: 0;
    }

    #map-container.is-night #map-night {
      opacity: 1;
    }

    /* í´ë¦­ ê°€ëŠ¥í•œ íˆ¬ëª… êµ¬ì—­ ê³µí†µ ìŠ¤íƒ€ì¼ */
    .click-zone {
      position: absolute;
      background: transparent;
      cursor: pointer;
    }

    /* ê°€ì´ë“œìš© ë³´ë” & ì§€íŒ¡ì´ ì»¤ì„œ */
    .click-zone:hover,
    .click-zone:focus-visible {
      outline: 1px dashed transparent; /* ê°€ì´ë“œì„ ì€ íˆ¬ëª… ì²˜ë¦¬ */
      outline-offset: -2px;
      cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"><path fill="%23ffd700" d="M12 2l2.39 4.85L20 7.27l-4 3.9.95 5.53L12 14.77 7.05 16.7 8 11.17l-4-3.9 5.61-.42z"/></svg>') 8 8, pointer;
    }

    /* ì˜¤ë¥¸ìª½ ìƒë‹¨ ì»¨íŠ¸ë¡¤ ìŠ¤íƒ */
    #control-stack {
      position: absolute;
      top: 12px;
      right: 12px;
      display: grid;
      gap: 8px;
      z-index: 10;
      width: clamp(90px, 8vw, 110px);
    }

    .control-card {
      background: rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(6px);
      border-radius: 10px;
      padding: 8px 9px;
      color: #fff;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.28);
    }

    .card-title {
      font-size: 11px;
      opacity: 0.85;
      margin-bottom: 6px;
      letter-spacing: 0.1px;
    }

    .slider-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .icon-sun,
    .icon-moon {
      font-size: 14px;
      user-select: none;
    }

    input[type="range"].pill {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 4px;
      border-radius: 999px;
      background: linear-gradient(90deg, #ffde70 0%, #ffeaa7 40%, #bcd0ff 60%, #5b7bd5 100%);
      outline: none;
    }

    input[type="range"].pill::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #ffffff;
      border: 1.5px solid #222;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: transform 0.15s ease;
    }

    input[type="range"].pill::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #ffffff;
      border: 1.5px solid #222;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: transform 0.15s ease;
    }

    input[type="range"].pill:active::-webkit-slider-thumb,
    input[type="range"].pill:active::-moz-range-thumb {
      transform: scale(1.05);
    }

    /* ìŒì•… ì¹´ë“œ */
    #bgm-controls {
      display: grid;
      gap: 6px;
    }

    .button-row {
      display: flex;
      gap: 6px;
    }

    .btn-ghost {
      flex: 1;
      padding: 6px 7px;
      border-radius: 7px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.06);
      color: #fff;
      font-size: 11px;
      cursor: pointer;
      transition: background 0.2s ease, border 0.2s ease;
    }

    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(255, 255, 255, 0.35);
    }

    #bgm-volume-row {
      display: grid;
      gap: 4px;
      font-size: 11px;
    }

    #bgm-volume {
      width: 100%;
    }

    #bgm-volume-value {
      font-size: 10px;
      opacity: 0.85;
      text-align: right;
    }

    /* ì•¨ë²” í”Œë ˆì´ì–´ ëª¨ë‹¬ */
    #player-modal {
      position: fixed;
      inset: 0;
      display: none; /* ì´ˆê¸° ìˆ¨ê¹€ */
      background: rgba(0, 0, 0, 0.55);
      z-index: 20;
      backdrop-filter: blur(2px);
    }

    #player-modal .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(20, 20, 20, 0.92);
      border-radius: 8px;
      padding: 14px;
      width: 400px;
      height: 500px;
      color: #f5f5f5;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
      display: grid;
      gap: 12px;
      text-align: center;
    }

    #player-modal .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      border: none;
      background: transparent;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      padding: 4px 8px;
    }

    #current-album-art {
      width: 100%;
      height: auto;
      max-height: 260px;
      border-radius: 12px;
      object-fit: cover;
    }

    #current-song-title {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    #audio-player {
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map-container">
    <div id="control-stack">
      <div id="mode-card" class="control-card">
        <div class="card-title">ë‚® / ë°¤</div>
        <div class="slider-row">
          <span class="icon-sun" aria-hidden="true">â˜€ï¸</span>
          <input
            id="mode-slider"
            class="pill"
            type="range"
            min="0"
            max="1"
            step="0.01"
            value="0"
            aria-label="ë‚®/ë°¤ ì „í™˜ ìŠ¬ë¼ì´ë”"
          />
          <span class="icon-moon" aria-hidden="true">ğŸŒ™</span>
        </div>
      </div>

      <div id="bgm-card" class="control-card">
        <div class="card-title">ë°°ê²½ìŒì•…</div>
        <div id="bgm-controls">
          <div class="button-row">
            <button id="bgm-toggle" class="btn-ghost" type="button">ì¬ìƒ</button>
            <button id="bgm-mute" class="btn-ghost" type="button">ìŒì†Œê±°</button>
          </div>
          <div id="bgm-volume-row">
            <label for="bgm-volume">ë³¼ë¥¨</label>
            <input
              type="range"
              id="bgm-volume"
              class="pill pill-volume"
              min="0"
              max="1"
              step="0.01"
              value="0.5"
            />
            <div id="bgm-volume-value">50%</div>
          </div>
          <div id="bgm-status" style="font-size: 10px; opacity: 0.85; text-align: right;">ì •ì§€</div>
        </div>
      </div>
    </div>
    <img id="map-day" class="map-layer" src="village_map.png" alt="ë§ˆì„ í•­ê³µìƒ· ë‚®" />
    <img id="map-night" class="map-layer" src="village_map.night.jpg" alt="ë§ˆì„ í•­ê³µìƒ· ë°¤" />

    <!-- ì„ì‹œ ìœ„ì¹˜ë¡œ ì¤‘ì•™ ë¶€ê·¼ì— ë°°ì¹˜ëœ 9ê°œ ì˜ì—­ (ë‚˜ì¤‘ì— top/left/width/height ìˆ˜ì • ê°€ëŠ¥) -->
    <div
      id="zone-1"
      class="click-zone"
      data-image="ë´„ì´ë¼ëŠ” ì´ìœ ë¡œ.jpg"
      data-title="ë´„ì´ë¼ëŠ” ì´ìœ ë¡œ"
      style="top: 30%; left: 11%; width: 5%; height: 10%;"
    ></div>
    <div
      id="zone-2"
      class="click-zone"
      data-image="ë§ì˜ ì˜¨ë„.jpg"
      data-title="ë§ì˜ ì˜¨ë„"
      style="top: 10%; left: 79%; width: 5%; height: 10%;"
    ></div>
    <div
      id="zone-3"
      class="click-zone"
      data-image="ì˜ì›í•˜ê²Œ í•˜ì—¬ì£¼ì˜¤.jpg"
      data-title="ì˜ì›í•˜ê²Œ í•˜ì—¬ì£¼ì˜¤"
      style="top: 51%; left: 47%; width: 5%; height: 10%;"
    ></div>

    <div
      id="zone-4"
      class="click-zone"
      data-image="ê·¸ ì—¬ë¦„, ê·¸ ê³¨ëª©.jpg"
      data-title="ê·¸ ì—¬ë¦„, ê·¸ ê³¨ëª©"
      style="top: 44%; left: 79%; width: 5%; height: 10%;"
    ></div>
    <div
      id="zone-5"
      class="click-zone"
      data-image="ê·¸ë¦¬ì›€ì´ ë¨¸ë¬´ëŠ” ê³³.jpg"
      data-title="ê·¸ë¦¬ì›€ì´ ë¨¸ë¬´ëŠ” ê³³"
      style="top: 36%; left: 47%; width: 5%; height: 10%;"
    ></div>
    <div
      id="zone-6"
      class="click-zone"
      data-image="ë„ˆë¼ëŠ” ê°€ì„.jpg"
      data-title="ë„ˆë¼ëŠ” ê°€ì„"
      style="top: 40%; left: 2%; width: 5%; height: 10%;"
    ></div>

    <div
      id="zone-7"
      class="click-zone"
      data-image="ë„ˆì™€ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤.jpg"
      data-title="ë„ˆì™€ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤"
      style="top: 32%; left: 27%; width: 5%; height: 10%;"
    ></div>
    <div
      id="zone-8"
      class="click-zone"
      data-image="ìš°ë¦¬ ë³´ê³  ì‹¶ìœ¼ë©´ ë§Œë‚˜ì.jpg"
      data-title="ìš°ë¦¬ ë³´ê³  ì‹¶ìœ¼ë©´ ë§Œë‚˜ì"
      style="top: 8%; left: 68%; width: 5%; height: 10%;"
    ></div>
    <div
      id="zone-9"
      class="click-zone"
      data-image="ì•„ë¦„ë‹¤ìš´ ì„¸ìƒ.jpg"
      data-title="ì•„ë¦„ë‹¤ìš´ ì„¸ìƒ"
      style="top: 59%; left: 59%; width: 5%; height: 10%;"
    ></div>
    <div
      id="zone-10"
      class="click-zone"
      data-image="ë¶•ì–´ë¹µ.jpg"
      data-title="ë¶•ì–´ë¹µ"
      style="top: 61%; left: 70%; width: 5%; height: 10%;"
    ></div>
  </div>

  <!-- ì•¨ë²” í”Œë ˆì´ì–´ ëª¨ë‹¬ -->
  <div id="player-modal" aria-hidden="true">
    <div class="modal-content">
      <button class="close-btn" type="button" aria-label="ë‹«ê¸°">âœ•</button>
      <img id="current-album-art" src="" alt="ì•¨ë²” ì»¤ë²„" />
      <h3 id="current-song-title">ë…¸ë˜ ì œëª©</h3>
      <div id="track-status" style="font-size: 12px; opacity: 0.9;">ì •ì§€</div>
      <audio id="audio-player" controls></audio>
    </div>
  </div>

  <!-- ë°°ê²½ìŒì•… (íŒŒì¼ëª…ì„ êµì²´í•´ ì‚¬ìš©í•˜ì„¸ìš”) -->
  <audio id="bgm-audio" src="ë”°ëœ»í•œ ëˆˆì´ ë‚´ë¦¬ëŠ” ë§ˆì„.mp3" loop preload="metadata"></audio>

  <script>
    const mapContainer = document.getElementById('map-container');
    const modeSlider = document.getElementById('mode-slider');
    const bgmToggle = document.getElementById('bgm-toggle');
    const bgmMuteBtn = document.getElementById('bgm-mute');
    const bgmVolume = document.getElementById('bgm-volume');
    const bgmVolumeValue = document.getElementById('bgm-volume-value');
    const dayImg = document.getElementById('map-day');
    const nightImg = document.getElementById('map-night');
    const playerModal = document.getElementById('player-modal');
    const closeBtn = playerModal.querySelector('.close-btn');
    const modalContent = playerModal.querySelector('.modal-content');
    const clickZones = document.querySelectorAll('.click-zone');
    const albumArtEl = document.getElementById('current-album-art');
    const songTitleEl = document.getElementById('current-song-title');
    const audioPlayer = document.getElementById('audio-player');
    const trackStatus = document.getElementById('track-status');
    const bgmAudio = document.getElementById('bgm-audio');
    const bgmStatus = document.getElementById('bgm-status');

    const clamp = (value, min, max) => Math.max(min, Math.min(value, max));

    // ë°¤ ì´ë¯¸ì§€ ì‚¬ì „ ë¡œë“œ (ë¸Œë¼ìš°ì €ê°€ ìºì‹œí•˜ë„ë¡)
    if (nightImg.complete === false) {
      nightImg.addEventListener('load', () => {
        /* no-op */
      });
    }

    // êµ¬ì—­ë³„ ì•¨ë²”/ì˜¤ë””ì˜¤ ë§¤í•‘
    const zoneData = {
      'zone-1': { image: 'ë´„ì´ë¼ëŠ” ì´ìœ ë¡œ.jpg', title: 'ë´„ì´ë¼ëŠ” ì´ìœ ë¡œ', audio: 'ë´„ì´ë¼ëŠ” ì´ìœ ë¡œ.mp3' },
      'zone-2': { image: 'ë§ì˜ ì˜¨ë„.jpg', title: 'ë§ì˜ ì˜¨ë„', audio: 'ë§ì˜ ì˜¨ë„.mp3' },
      'zone-3': { image: 'ì˜ì›í•˜ê²Œ í•˜ì—¬ì£¼ì˜¤.jpg', title: 'ì˜ì›í•˜ê²Œ í•˜ì—¬ì£¼ì˜¤', audio: 'ì˜ì›í•˜ê²Œ í•˜ì—¬ì£¼ì˜¤.mp3' },
      'zone-4': { image: 'ê·¸ ì—¬ë¦„, ê·¸ ê³¨ëª©.jpg', title: 'ê·¸ ì—¬ë¦„, ê·¸ ê³¨ëª©', audio: 'ê·¸ ì—¬ë¦„, ê·¸ ê³¨ëª©.mp3' },
      'zone-5': { image: 'ê·¸ë¦¬ì›€ì´ ë¨¸ë¬´ëŠ” ê³³.jpg', title: 'ê·¸ë¦¬ì›€ì´ ë¨¸ë¬´ëŠ” ê³³', audio: 'ê·¸ë¦¬ì›€ì´ ë¨¸ë¬´ëŠ” ê³³.mp3' },
      'zone-6': { image: 'ë„ˆë¼ëŠ” ê°€ì„.jpg', title: 'ë„ˆë¼ëŠ” ê°€ì„', audio: 'ë„ˆë¼ëŠ” ê°€ì„.mp3' },
      'zone-7': { image: 'ë„ˆì™€ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤.jpg', title: 'ë„ˆì™€ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤', audio: 'ë„ˆì™€ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤.mp3' },
      'zone-8': { image: 'ìš°ë¦¬ ë³´ê³  ì‹¶ìœ¼ë©´ ë§Œë‚˜ì.jpg', title: 'ìš°ë¦¬ ë³´ê³  ì‹¶ìœ¼ë©´ ë§Œë‚˜ì', audio: 'ìš°ë¦¬ ë³´ê³  ì‹¶ìœ¼ë©´ ë§Œë‚˜ì.mp3' },
      'zone-9': { image: 'ì•„ë¦„ë‹¤ìš´ ì„¸ìƒ.jpg', title: 'ì•„ë¦„ë‹¤ìš´ ì„¸ìƒ', audio: 'ì•„ë¦„ë‹¤ìš´ ì„¸ìƒ.mp3' },
      'zone-10': { image: 'ë¶•ì–´ë¹µ.jpg', title: 'ë¶•ì–´ë¹µ', audio: 'ë¶•ì–´ë¹µ.mp3' },
    };

    let isNight = false;
    let isBgmOn = false;
    let isMuted = false;
    let lastVolume = parseFloat(bgmVolume.value) || 0.5;
    let wasBgmPlayingBeforeModal = false;
    let trackPlayRequested = false;
    let trackHasPlayed = false;

    const applyNightMode = () => {
      if (isNight) {
        mapContainer.classList.add('is-night');
        nightImg.setAttribute('aria-hidden', 'false');
        dayImg.setAttribute('aria-hidden', 'true');
        modeSlider.value = 1;
      } else {
        mapContainer.classList.remove('is-night');
        nightImg.setAttribute('aria-hidden', 'true');
        dayImg.setAttribute('aria-hidden', 'false');
        modeSlider.value = 0;
      }
    };

    modeSlider.addEventListener('input', (e) => {
      const val = parseFloat(e.target.value);
      isNight = val >= 0.5;
      applyNightMode();
    });

    applyNightMode();

    const updateBgmUI = () => {
      bgmToggle.textContent = isBgmOn ? 'ì¼ì‹œì •ì§€' : 'ì¬ìƒ';
      bgmMuteBtn.textContent = isMuted ? 'ìŒì†Œê±° í•´ì œ' : 'ìŒì†Œê±°';
      bgmVolumeValue.textContent = `${Math.round(bgmAudio.volume * 100)}%`;
      bgmStatus.textContent = isBgmOn ? 'ì¬ìƒ ì¤‘' : 'ì •ì§€';
    };

    const setBgmVolume = (value, { fromSlider = false } = {}) => {
      const vol = clamp(value, 0, 1);
      bgmAudio.volume = vol;
      bgmVolume.value = vol;

      if (vol === 0) {
        isMuted = true;
      } else {
        if (fromSlider) {
          isMuted = false;
          lastVolume = vol;
        } else if (!isMuted) {
          lastVolume = vol;
        }
      }

      updateBgmUI();
    };

    setBgmVolume(lastVolume);

    bgmVolume.addEventListener('input', (e) => {
      setBgmVolume(parseFloat(e.target.value) || 0, { fromSlider: true });
    });

    bgmMuteBtn.addEventListener('click', () => {
      if (!isMuted) {
        lastVolume = bgmAudio.volume || lastVolume || 0.5;
        setBgmVolume(0);
        isMuted = true;
      } else {
        setBgmVolume(lastVolume || 0.5);
        isMuted = false;
      }
      updateBgmUI();
    });

    bgmToggle.addEventListener('click', async () => {
      if (!isBgmOn) {
        try {
          await bgmAudio.play();
          isBgmOn = true;
        } catch (err) {
          console.error('ë°°ê²½ìŒì•… ì¬ìƒ ì‹¤íŒ¨:', err);
        }
      } else {
        bgmAudio.pause();
        isBgmOn = false;
      }
      updateBgmUI();
    });

    bgmAudio.addEventListener('pause', () => {
      isBgmOn = false;
      updateBgmUI();
    });

    bgmAudio.addEventListener('play', () => {
      isBgmOn = true;
      updateBgmUI();
    });

    bgmAudio.addEventListener('volumechange', () => {
      bgmVolume.value = bgmAudio.volume;
      isMuted = bgmAudio.volume === 0;
      if (!isMuted) {
        lastVolume = bgmAudio.volume;
      }
      updateBgmUI();
    });

    audioPlayer.addEventListener('playing', () => {
      trackHasPlayed = true;
      setTrackStatus('ì¬ìƒ ì¤‘');
    });

    audioPlayer.addEventListener('play', () => {
      trackHasPlayed = true;
      setTrackStatus('ì¬ìƒ ì¤‘');
    });

    audioPlayer.addEventListener('pause', () => {
      if (trackHasPlayed || trackPlayRequested) {
        setTrackStatus('ì¼ì‹œì •ì§€');
      }
    });

    audioPlayer.addEventListener('ended', () => setTrackStatus('ì¬ìƒ ì™„ë£Œ'));
    audioPlayer.addEventListener('error', () => setTrackStatus('ì¬ìƒ ì˜¤ë¥˜'));

    // ëª¨ë‹¬ ê´€ë ¨ ìš”ì†Œ
    const setTrackStatus = (text) => {
      trackStatus.textContent = text;
    };

    const openPlayerModal = (anchorRect, zoneId) => {
      const info = zoneData[zoneId] || {};
      const imageSrc = info.image || '';
      const titleText = info.title || 'ë…¸ë˜ ì œëª©';
      const audioSrc = info.audio || '';

      if (imageSrc) {
        albumArtEl.src = imageSrc;
        albumArtEl.alt = `${titleText} ì•¨ë²” ì»¤ë²„`;
      } else {
        albumArtEl.removeAttribute('src');
      }

      songTitleEl.textContent = titleText;

      // ë°°ê²½ìŒì•… ì •ì§€ ìƒíƒœ ê¸°ì–µ í›„ ì¼ì‹œ ì •ì§€
      wasBgmPlayingBeforeModal = !bgmAudio.paused;
      if (wasBgmPlayingBeforeModal) {
        bgmAudio.pause();
      }

      // ê³¡ ì„¸íŒ… í›„ ì¬ìƒ
      audioPlayer.pause();
      audioPlayer.currentTime = 0;
      if (audioSrc) {
        audioPlayer.src = audioSrc;
        audioPlayer.load();
        trackPlayRequested = true;
        trackHasPlayed = false;
        setTrackStatus('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
        audioPlayer.play().then(() => {
          trackHasPlayed = true;
          setTrackStatus('ì¬ìƒ ì¤‘');
        }).catch((err) => {
          console.error('íŠ¸ë™ ì¬ìƒ ì‹¤íŒ¨:', err);
          setTrackStatus('ì¬ìƒ ì‹¤íŒ¨ (íŒŒì¼ í™•ì¸)');
        });
      } else {
        audioPlayer.removeAttribute('src');
        setTrackStatus('íŠ¸ë™ ì—†ìŒ');
      }

      playerModal.style.display = 'block';
      playerModal.setAttribute('aria-hidden', 'false');

      // ìœ„ì¹˜ ê³„ì‚°ì„ ìœ„í•´ ìš°ì„  ë Œë”ë§
      requestAnimationFrame(() => {
        const modalRect = modalContent.getBoundingClientRect();
        const targetX = anchorRect.left + anchorRect.width / 2;
        const targetY = anchorRect.top + anchorRect.height / 2;

        const maxLeft = window.innerWidth - modalRect.width - 16;
        const maxTop = window.innerHeight - modalRect.height - 16;

        const left = clamp(targetX - modalRect.width / 2, 16, Math.max(16, maxLeft));
        const top = clamp(targetY - modalRect.height / 2, 16, Math.max(16, maxTop));

        modalContent.style.transform = 'none';
        modalContent.style.left = `${left}px`;
        modalContent.style.top = `${top}px`;
      });
    };

    const closePlayerModal = () => {
      playerModal.style.display = 'none';
      playerModal.setAttribute('aria-hidden', 'true');

      // íŠ¸ë™ ì •ì§€
      audioPlayer.pause();
      audioPlayer.currentTime = 0;
      trackPlayRequested = false;
      trackHasPlayed = false;
      setTrackStatus('ì •ì§€');

      // ë°°ê²½ìŒì•… ì¬ê°œ
      if (wasBgmPlayingBeforeModal) {
        bgmAudio.play().catch(() => {/* ignore */});
      }
      wasBgmPlayingBeforeModal = false;
    };

    closeBtn.addEventListener('click', closePlayerModal);

    // ESCë¡œ ë‹«ê¸°
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closePlayerModal();
      }
    });

    // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°
    playerModal.addEventListener('click', (e) => {
      if (e.target === playerModal) {
        closePlayerModal();
      }
    });

    clickZones.forEach((zone) => {
      zone.addEventListener('click', (e) => {
        const rect = e.currentTarget.getBoundingClientRect();
        openPlayerModal(rect, zone.id);
      });
    });

    // ì´ˆê¸° ìƒíƒœëŠ” ë‹«í˜
    closePlayerModal();
  </script>
</body>
</html>

